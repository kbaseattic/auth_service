<html><head><title>KBase Authorization Service</title><style type="text/css">ol{margin:0;padding:0}.c4{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c2{font-size:10pt;font-family:"Courier New";font-weight:bold}.c6{color:inherit;text-decoration:inherit}.c5{color:#666666;font-size:12pt}.c7{color:#1155cc;text-decoration:underline}.c0{direction:ltr}.c3{font-weight:bold}.c1{height:11pt}.title{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:36pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:24pt;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:24pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";font-weight:bold;padding-bottom:6pt}h2{padding-top:18pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h3{padding-top:14pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";font-weight:bold;padding-bottom:4pt}h4{padding-top:12pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:2pt}h5{padding-top:11pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";font-weight:bold;padding-bottom:2pt}h6{padding-top:10pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:10pt;font-family:"Arial";padding-bottom:2pt}</style></head><body class="c4"><h1 class="c0"><a name="h.nj7pzqyt9tjf"></a><span>Introduction</span></h1><p class="c0 c1"><span></span></p><p class="c0"><span>This is a mongodb backed REST based authorization service (currently implemented in python/django/piston). The authorization service simply serves up JSON docs that specify a set of permissions, and the users who have that set of permissions.</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>Here is a sample JSON object:</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>{</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;role_owner&quot;: &quot;sychan&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;role_id&quot;: &quot;kbase_users&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;description&quot;: &quot;List of user ids who are considered KBase users&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;members&quot;: [</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &quot;sychan&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &quot;kbasetest&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &quot;kbauthorz&quot;</span></p><p class="c0"><span>&nbsp; &nbsp; ],</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;role_updater&quot;: [</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &quot;sychan&quot;,</span></p><p class="c0"><span>&nbsp; &nbsp; &nbsp; &nbsp; &quot;kbauthorz&quot;</span></p><p class="c0"><span>&nbsp; &nbsp; ],</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;read&quot;: [],</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;create&quot;: [],</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;modify&quot;: [],</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;impersonate&quot;: [],</span></p><p class="c0"><span>&nbsp; &nbsp; &quot;delete&quot;: [],</span></p><p class="c0"><span>&nbsp; &nbsp; &ldquo;owns&rdquo;: []</span></p><p class="c0"><span>}</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;Here are the semantics of the fields:</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;&#39;role_id&#39; : &#39;Unique human readable identifer for role (required)&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;description&#39; : &#39;Description of the role (required)&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;role_owner&#39; : &#39;Owner(creator) of this role&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;role_updater&#39; : &#39;User_ids that can update this role&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;members&#39; : &#39;A list of the user_ids who are members of this group&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;read&#39; : &#39;List of kbase object ids (strings) that this role allows read privs&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;modify&#39; : &#39;List of kbase object ids (strings) that this role allows modify privs&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;delete&#39; : &#39;List of kbase object ids (strings) that this role allows delete privs&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;impersonate&#39; : &#39;List of kbase user_ids (strings) that this role allows impersonate privs&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;grant&#39; : &#39;List of kbase authz role_ids (strings) that this role allows grant privs&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&#39;create&#39; : &#39;Boolean value - does this role provide the create privilege&#39;,</span></p><p class="c0"><span>&nbsp; &nbsp;&lsquo;owns&rsquo; : a list of document ids that are owned by the role_owner and role_updater. A user cannot set privs on doc_ids that they do not own. For documents that do not yet have an owner, it is possible to set ownership and permissions in the same role document. Note that only certain users are able to assign ownership - currently this group is identical to kbase_users, but it will be narrowed down in the future.</span></p><p class="c0 c1"><span></span></p><p class="c0 c1"><span></span></p><h1 class="c0"><a name="h.5hy7uvtfuhmu"></a><span>API</span></h1><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;This is a basic, conventional REST service that uses the content-type application/json for all message bodies. The service is typically mounted under services/authorization/Roles. All access to the service must include a valid Globus Online token for a user that is a known KBase user. KBase membership is determined by being in the &ldquo;members&rdquo; field of the kbase_users role - note that kbase_users is the default, but it can be overridden by naming a different role in the django local_settings.py file.</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;Here are the authentication requirements for each HTTP method:</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;GET : requires valid token and membership in group identified by settings.kbase_users</span></p><p class="c0"><span>&nbsp; &nbsp;PUT : requires valid token and user in role_owner, or in the role_updater field for object</span></p><p class="c0"><span>&nbsp; &nbsp;POST : requires valid token and membership in role_id in settings.kbase_users</span></p><p class="c0"><span>&nbsp; &nbsp;DELETE : requires valid token and request must come from role_owner of target object</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;As an example of how to query the service from the command line, here is a curl request that puts the appropriate token in the Authorization: header and pulls up a list of all the roles currently known:</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c2">curl -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-11e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; http://140.221.92.45:7039/Roles/</span></p><p class="c0"><span class="c2">[</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;kbase_users&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;kbase_test&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;kbase_test_users&quot;</span></p><p class="c0"><span class="c2">]</span></p><h3 class="c0"><a name="h.uyoa72ytvxp6"></a><span>Document Ownership</span></h3><p class="c0"><span class="c3 c5">&nbsp; &nbsp;</span><span>Part of the access control model is that only owners of documents are able to to set access control permissions on them. Ownership is established by the &ldquo;owns&rdquo; clause with a list of document IDs. Only members of a specified group (currently set to be kbase_users for development testing) can set ownership - the intention is to restrict initial ownership assertions to service principals and administrative users.</span></p><p class="c0"><span>&nbsp; &nbsp;A user can only set privs on a document if:</span></p><p class="c0"><span>&nbsp; &nbsp;1) The current user is in the group of users allowed to set ownership</span></p><p class="c0"><span>&nbsp; &nbsp;2) There are pre-existing roles document that gives ownership privileges on the documents referenced in the current roles specification</span></p><p class="c0"><span>&nbsp; &nbsp;3) There are no current owners for the documents being referenced, and this document sets ownership for the un-owned documents</span></p><p class="c0 c1"><span></span></p><h2 class="c0"><a name="h.2u8d7m8nl38t"></a><span>GET</span></h2><p class="c0"><span>&nbsp; &nbsp;The GET method will return a list of records that match the specified criteria. The URL component that comes after the /Roles/ prefix is parsed as the &ldquo;role_id&rdquo; to match for a single query. If nothing comes after /Roles/ then a list of all role_id will be return (as in the example able).</span></p><p class="c0"><span>&nbsp; &nbsp; URL parameters can be passed after a &lsquo;?&rsquo; in the URL. The GET method supports the following URL variables parameters:</span></p><p class="c0"><span>&nbsp; &nbsp; </span><span class="c3">about </span><span>&nbsp;parameter that provides a description of the Roles service</span></p><p class="c0"><span>&nbsp; &nbsp; </span><span class="c3">filter={mongodb filter string}</span><span>&nbsp;A MongoDB JSON filter string that is passed into mongodb for filtering. See </span><span class="c7"><a class="c6" href="http://www.mongodb.org/display/DOCS/Querying">http://www.mongodb.org/display/DOCS/Querying</a></span><span>&nbsp;under &lt;query&gt; argument for find()</span></p><p class="c0"><span>&nbsp; &nbsp; </span><span class="c3">fields=</span><span class="c3">{mongodb filter string} </span><span>A MongoDB field specification string to limit the fields that are returned in the query. See the link referenced above for the &lt;projection&gt; argument</span></p><p class="c0"><span>&nbsp; &nbsp; </span><span class="c3">union </span><span>The presence of this parameter will cause the roles service to take all the return documents and merge them into a single document where the values of (grant,read,create,modify,delete,owns and members) attributes are merged and deduped, resulting in a single document that has a grant field that is the union of all the component grant fields, likewise for the read, create, etc... fields. This is a intended to provide an easy way to summarize the relevant ACLs for a document or user.</span></p><p class="c0"><span>&nbsp; &nbsp; </span><span class="c3">user_id=username</span><span>&nbsp;Find the ACLs that contain username among the members</span></p><p class="c0"><span>&nbsp; &nbsp; </span><span class="c3">doc_id=doc_id</span><span>&nbsp;Find the ACLs that reference doc_id in their grant, read,create,modify,delete or owns clauses.</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp; Here is a sample query for the &ldquo;about&rdquo; information:</span></p><p class="c0"><span class="c2">curl -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-1e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; &#39;http://140.221.92.45:7039/Roles/?about&#39;</span></p><p class="c0"><span class="c2">[</span></p><p class="c0"><span class="c2">&nbsp; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;usage&quot;: &quot;This is a standard REST service. Note that read handler takes MongoDB filtering and JSON field selection options passed as URL parameters &#39;filter&#39; and &#39;fields&#39; respectively. For example, to get a list of all role_id&#39;s use: /Roles/?filter={ \&quot;role_id\&quot; : { \&quot;$regex\&quot; : \&quot;.*\&quot; }}&amp;fields={ \&quot;role_id\&quot; : \&quot;1\&quot;} Please look at MongoDB pymongo collection documentation for details. Read and Create are currently open to all authenticated users in role \&quot;kbase_users\&quot;, butdelete requires ownership of the document (in field role_owner), update requires ownership or membership in the target document&#39;s role_updaters list.&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;documentation&quot;: &quot;https://docs.google.com/document/d/1CTkthDUPwNzMF22maLyNIktI1sHdWPwtd3lJk0aFb20/edit&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;id&quot;: &quot;KBase Authorization&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;resources&quot;: {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;role_updater&quot;: &quot;User_ids that can update this role&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;description&quot;: &quot;Description of the role (required)&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;grant&quot;: &quot;List of kbase authz role_ids (strings) that this role allows grant privs&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;read&quot;: &quot;List of kbase object ids (strings) that this role allows read privs&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;create&quot;: &quot;Boolean value - does this role provide the create privilege&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;modify&quot;: &quot;List of kbase object ids (strings) that this role allows modify privs&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;role_owner&quot;: &quot;Owner(creator) of this role&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;role_id&quot;: &quot;Unique human readable identifer for role (required)&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;impersonate&quot;: &quot;List of kbase user_ids (strings) that this role allows impersonate privs&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;members&quot;: &quot;A list of the user_ids who are members of this group&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;delete&quot;: &quot;List of kbase object ids (strings) that this role allows delete privs&quot;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;contact&quot;: {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;email&quot;: &quot;sychan@lbl.gov&quot;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">&nbsp; }</span></p><p class="c0"><span>]</span></p><p class="c0"><span>For queries and filter parameters the filter parameter is passed as the first parameter and the fields parameter is the second parameter passed into the pymongo collection.find() method, see:</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c7"><a class="c6" href="http://api.mongodb.org/python/current/api/pymongo/collection.html">http://api.mongodb.org/python/current/api/pymongo/collection.html</a></span></p><p class="c0"><span>and</span></p><p class="c0"><span class="c7"><a class="c6" href="http://www.mongodb.org/display/DOCS/Querying">http://www.mongodb.org/display/DOCS/Querying</a></span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;As an example, the following query returns all role objects that have sychan as a member:</span></p><p class="c0"><span>http://authorization_host/Roles?filter={ &quot;members&quot; : &quot;sychan&quot;}</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c2">curl -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-11e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; &#39;http://140.221.92.45:7039/Roles/?filter=\{ &quot;members&quot; : &quot;sychan&quot;\}&#39;</span></p><p class="c0"><span class="c2">[</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;role_updater&quot;: [</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sychan&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;kbauthorz&quot;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; ],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;description&quot;: &quot;List of user ids who are considered KBase users&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;read&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;create&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;modify&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;role_owner&quot;: &quot;sychan&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;role_id&quot;: &quot;kbase_users&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;impersonate&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;members&quot;: [</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;sychan&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;kbasetest&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;kbauthorz&quot;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; ],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;delete&quot;: []</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">]</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;To pull up only the role_id fields use the URL parameters: filter={ &quot;members&quot; : &quot;sychan&quot;}&amp;fields={&quot;role_id&quot; : &quot;1&quot;}</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp; &nbsp;To pull up the role_id fields for roles with &quot;test&quot; as part of their name (PCRE regex) use the URL parameters: filter={ &quot;role_id&quot; : { &quot;$regex&quot; : &quot;.*test.*&quot; }}&amp;fields={ &quot;role_id&quot; : &quot;1&quot; }</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c2">curl -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-1e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; &#39;http://140.221.92.45:7039/Roles/?filter=\{ &quot;role_id&quot; : \{ &quot;$regex&quot; : &quot;.*test.*&quot; \}\}&amp;fields=\{ &quot;role_id&quot; : &quot;1&quot; \}&#39;</span></p><p class="c0"><span class="c2">[</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;role_id&quot;: &quot;kbase_test&quot;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; },</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &quot;role_id&quot;: &quot;kbase_test_users&quot;</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c2">]</span></p><p class="c0 c1"><span></span></p><h2 class="c0"><a name="h.vbr3ncfg8xyg"></a><span>POST</span></h2><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The POST method is used to create a new role entry. The role specification is a JSON object sent in the HTTP request body. The content-type should be &ldquo;application/json&rdquo; and amont the fields must be role_id, and description - role_id must not conflict with an existing role, or else an HTTP error code 409 will be returned. If the required fields are not included then HTTP error code 400 will be returned. Other fields that are left empty will be populated with empty lists.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The role_owner field is always set to the user_id on the token requesting the new role. At this time, the creator of the role can assign a list of users who are allowed to update this role by putting their names in the field &ldquo;role_updater&rdquo;. Any requesting presenting a token for either the role_owner or a member of role_updater is able to update the contents of this role. Note that a user can accidentally remove their own ability to update the role.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If the role is created successfully, HTTP response code 201 is returned. Any error conditions that arise during creation will return HTTP response code 400 along with a message body that describes the exception triggered.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Here is a posting for a minimalist test role:</span></p><p class="c0"><span class="c2">curl -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-11e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; -H &quot;Content-Type: application/json&quot; -d &#39;{ &quot;role_id&quot; : &quot;testrole_XXYYZZ&quot;, &quot;description&quot; : &quot;Example role creation&quot; }&#39; http://140.221.92.45:7039/Roles/</span></p><p class="c0"><span class="c2">Created</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">curl -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-11e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; &#39;http://140.221.92.45:7039/Roles/testrole_XXYYZZ&#39;</span></p><p class="c0"><span class="c2">[</span></p><p class="c0"><span class="c2">&nbsp; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;role_updater&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;description&quot;: &quot;Example role creation&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;grant&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;read&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;create&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;modify&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;role_owner&quot;: &quot;kbasetest&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;role_id&quot;: &quot;testrole_XXYYZZ&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;impersonate&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;members&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;delete&quot;: []</span></p><p class="c0"><span class="c2">&nbsp; }</span></p><p class="c0"><span>]</span></p><h2 class="c0"><a name="h.thjrmj8axt0w"></a><span>PUT</span></h2><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The put method is used to update an existing role entry. It is passed a role_id as the URL segment after /Roles/, or the role_id can be declared in the JSON object that is passed as the message body. The fields that are passed in the message body are updated, leaving the other fields un-modified. Only the owner, and members of the role&rsquo;s role_updater field can perform updates - otherwise an HTTP code 401 is returned. A successful update returns HTTP code 201. If the role_id is not specified, or any other error arises, HTTP code 400 will be returned with the particular error in the message body.</span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;To simply update the existing record by adding new members put &ldquo;addmembers=&rdquo; among the URL variables. To delete members use &ldquo;deletemembers=&rdquo; among the URL variables. Note that the members to add or delete are passed in the member attribute of the request body, and </span><span class="c3">any values passed in the URL variables are discarded</span><span>.</span></p><p class="c0 c1"><span></span></p><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Sample curl code:</span></p><p class="c0"><span class="c2">curl &nbsp;-X PUT -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-11e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; -H &quot;Content-Type: application/json&quot; -d &#39;{ &quot;role_id&quot; : &quot;testrole_XXYYZZ&quot;, &quot;description&quot; : &quot;Example role creation updated&quot; }&#39; http://140.221.92.45:7039/Roles/</span></p><p class="c0"><span class="c2">Created</span></p><p class="c0 c1"><span class="c2"></span></p><p class="c0"><span class="c2">curl -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-11e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; &#39;http://140.221.92.45:7039/Roles/testrole_XXYYZZ&#39;</span></p><p class="c0"><span class="c2">[</span></p><p class="c0"><span class="c2">&nbsp; {</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;role_updater&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;description&quot;: &quot;Example role creation updated&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;grant&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;read&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;create&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;modify&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;role_owner&quot;: &quot;kbasetest&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;role_id&quot;: &quot;testrole_XXYYZZ&quot;,</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;impersonate&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;members&quot;: [],</span></p><p class="c0"><span class="c2">&nbsp; &nbsp; &quot;delete&quot;: []</span></p><p class="c0"><span class="c2">&nbsp; }</span></p><p class="c0"><span>]</span></p><h2 class="c0"><a name="h.391wz11zwq1u"></a><span>DELETE</span></h2><p class="c0"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The delete method is used to remove an entry. The role_id is passed in the URL after the /Roles/ segment, and no message body is expected. Only the user named in the role_owner field can delete a role, HTTP response code 401 is returned for attempts by users other than the owner to delete it. A successful deletion returns HTTP response code 204 with an empty response body.</span></p><p class="c0 c1"><span></span></p><p class="c0"><span class="c2">curl -X DELETE -H &quot;Authorization: OAuth un=kbasetest|tokenid=9b999bd0-1a1a-11e2-a2a1-12313d2d6e7f|expiry=1382207235|client_id=kbasetest|token_type=Bearer|SigningSubject=https://nexus.api.globusonline.org/goauth/keys/ff88f66e-1861-11e2-ae19-12313809f035|sig=4137bb5e87c82e1852d6053763237bec1e0378801624acdb9cc538b29dc04f5a69ecd69cc8530b93127fd38d4880856f5d35e18e92bdbe0050dad17a12432d25887528e074c3a26968478346c61a409727b24ba0f86cae871d4ce40620740fba1ccbfa54e6831cdd0a886b4bdf96a6cb05af7f72179652c45308f653d5f0eb27&quot; &#39;</span><span class="c2 c7"><a class="c6" href="http://140.221.92.45:7039/Roles/testrole_XXYYZZ&#39;">http://140.221.92.45:7039/Roles/testrole_XXYYZZ&#39;</a></span></p><p class="c0"><span class="c2">[empty response]</span></p><p class="c0 c1"><span></span></p></body></html>